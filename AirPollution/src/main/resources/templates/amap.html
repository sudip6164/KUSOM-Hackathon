<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/admindash.css">
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search/dist/leaflet-search.min.css" />
    <style>
        #map {
            height: 570px; /* Set the height of the map */
        }
    </style>
</head>
<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
 <!-- Navbar Brand-->
            <a class="navbar-brand ps-3" th:href="@{/admin/dash}"><img src="/assects/AeriesH.png" alt=""></a>
        <!-- Sidebar Toggle-->
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
        <!-- Navbar Search-->
        <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
            <div class="input-group">
                <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch" id="locationSearchInput" />
                <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
            </div>
        </form>
        <!-- Navbar-->
        <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a th:href="@{/logout}" class="dropdown-item">Logout</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" th:href="@{/admin}" href="#">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <div class="sb-sidenav-menu-heading">Feature</div>
                            .
                        <a class="nav-link" href="#" th:href="@{/admin/asensor}" >
                            <div class="sb-nav-link-icon"> <i class="fas fa-info-circle"></i></div>
                            Status
                        </a>
                        <a class="nav-link select" href="#" th:href="@{/admin/amap}" >
                            <div class="sb-nav-link-icon"><i class="fas fa-map-marker-alt"></i></div>Set New Location                            
                            
                        </a>
                <a class="nav-link" href="#" th:href="@{/admin/afeed}" >
                            <div class="sb-nav-link-icon"><i class="fas fa-list"></i></div> Feedback List                           
                            
                        </a>
                         
                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <div class="small">Logged in as:</div>
                    Administrator
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">
            <main>
                <div id="map"></div>
                
            </main>
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">Â©2024 Aeries.</div>
                        <div>
                            <a href="#">Privacy Policy</a>
                            &middot;
                            <a href="#">Terms &amp; Conditions</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js}" crossorigin="anonymous"></script>
    <script th:src="@{/js/scripts.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js}" crossorigin="anonymous"></script>
       <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-search/dist/leaflet-search.min.js"></script>
    <script>
        var map = L.map('map').setView([27.7172, 85.3240], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {}).addTo(map);
        var allMarkers = [];
    
        function updateMarkers(data) {
            allMarkers.forEach(marker => map.removeLayer(marker));
            allMarkers = [];
    
            data.forEach(sensor => {
                var marker = L.marker(sensor.latlng, { title: sensor.title }).addTo(map)
                    .bindPopup(sensor.title);
                allMarkers.push(marker);
            });
        }
    
        function fetchSensorData() {
            return [
                { latlng: [27.7172, 85.3240], title: 'Kathmandu Durbar Square (Sensor 1)' },
                { latlng: [27.6936, 85.3188], title: 'Patan Durbar Square (Sensor 2)' }
            ];
        }
    
        updateMarkers(fetchSensorData());
    
        function addNewSensorOnMapClick(e) {
            var title = prompt("Enter sensor title:");
            if (!title) return; // User canceled
    
            var newSensor = {
                latlng: e.latlng,
                title: title
            };
    
            var currentData = fetchSensorData();
            currentData.push(newSensor);
    
            updateMarkers(currentData);
    
            localStorage.setItem('sensorData', JSON.stringify(currentData)); // Store in local storage for simplicity
        }
    
        map.on('click', addNewSensorOnMapClick);
    
        setInterval(function () {
            // Simulate update of sensor data
            var updatedSensorData = [
                { latlng: [27.7172, 85.3240], title: 'Kathmandu Durbar Square (Sensor 1)' },
                { latlng: [27.6936, 85.3188], title: 'Patan Durbar Square (Sensor 2)' },
                { latlng: [27.7104, 85.3265], title: 'Bhaktapur Durbar Square (Sensor 3)' }
                // Simulated new sensor added
            ];
    
            // Update markers on the map
            updateMarkers(updatedSensorData);
    
            // Simulate sending updated data to user page (in a real app, this would be done via server-side communication)
            localStorage.setItem('sensorData', JSON.stringify(updatedSensorData)); // Store in local storage for simplicity
        }, 1000000); // Update every 100 seconds 
    </script>
    
</body>
</html>
